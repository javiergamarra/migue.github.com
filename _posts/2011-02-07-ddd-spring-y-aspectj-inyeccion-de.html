--- 
layout: post
name: ddd-spring-y-aspectj-inyeccion-de
title: "DDD, Spring y AspectJ: inyecci\xC3\xB3n de depencias (I)"
time: 2011-02-07 18:27:00 +01:00
---
<div style="text-align: justify;">El paradigma de orentación a objetos promueve que los objetos deberían tener datos y comportamiento. Sin embargo, en la realidad esto no se cumple en muchas ocasiones; especialmente en los objetos de dominio, donde habitualmente las clases se convierten en meros contenedores de información que se van pasando de unas capas a otras, delegando la funcionalidad en capas de servicio externas, creando un modelo anémico (para más información podéis acudir a&nbsp;<a href="http://www.martinfowler.com/bliki/AnemicDomainModel.html">http://www.martinfowler.com/bliki/AnemicDomainModel.html</a>).</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">A lo largo de las siguientes entradas promoveremos el paradigma de diseño dirigido por dominio y analizaremos como podremos enriquecer nuestros objetos de dominio mediante la inyección de dependencias. Para aquellos que estéis familiarizados con las últimas versiones de <a href="http://www.springsource.org/">Spring</a>, estas entradas no serán más que un paseo por los <i>internals</i> de <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">@Configurable</span><span class="Apple-style-span" style="font-family: inherit;">&nbsp;(anotación</span><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&nbsp;</span>que podemos encontrar las versiones más recientes de este popular framework) unidos a un poco de teoría.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Imaginemos por un momento que estamos desorrollando una tienda online para la venta de libros electrónicos y que la <a href="http://pastie.org/1533371">siguiente clase</a> modela nuestra entidad de dominio libro. Como podemos observar estamos delegando el cálculo del precio del libro en una clase independiente la cual será la encargada de realizar los cálculos necesarios (de este modo podremos configurar el precio del libro en función de nuestras necesidades). Y ahora: ¿cómo llevamos a cabo la inicialización del atributo&nbsp;<span class="Apple-style-span" style="font-size: 12px; line-height: 15px; white-space: pre;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">pricingStrategy</span></span><span class="Apple-style-span" style="font-family: 'Bitstream Vera Sans Mono', Monaco, Consolas, 'Courier New', monospace; font-size: 12px; line-height: 15px; white-space: pre;"> </span>?<br /><br />Desde aquí vamos a promover el uso de inyección de dependencias, de manera que añadiendo la infraestructura necesaria (en ese caso un simple setter para el atributo en cuestión) podremos delegar en un contenedor la responsabilidad de inyectar las dependencias necesarias en el momento en el que se instancie nuestro objeto. Siguiendo esta filosofía podríamos intercambiar las estrategias de cálculo de precios sin más que realizar una ligera modificación en la configuración, sin la necesidad de modificar nuestro código fuente. Este enfoque también nos permite llevar a cabo nuestras pruebas unitarias de manera extremadamente sencilla.<br /><br />Antes de comenzar a escribir nuestros propios aspectos (lo dejaremos para la próxima entrada) veamos cómo podríamos inyectar las dependencias en nuestro objeto de dominio mediante el uso de spring y un poco de configuración.<br /><br />En primer lugar tendremos que indicarle a spring que nuestra clase de dominio <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">Book</span> necesita que sus dependencias sean inyectadas: para ello anotamos la definición de nuestra clase con <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">@Configurable</span> y añadimos un <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">setter</span> para nuestro atributo de clase <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">pricingStrategy</span>. Adicionalmente, anotaremos &nbsp;el <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">setter</span> anterior (o la propiedad) con <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">@Autowired</span><span class="Apple-style-span" style="font-family: inherit;">. <span class="Apple-style-span" style="font-family: inherit;">Finalmente, definiremos en el contexto de aplicación de spring una implementación concreta del interfaz</span></span>&nbsp;<span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">PricingStrategy</span> e indicamos que estamos haciendo uso <span class="Apple-style-span" style="font-size: x-small;">@Configurable</span> mediante la instrucción&nbsp;<span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><context:spring-configured></context:spring-configured></span>.<br /><br />Con la sencilla configuración anterior, cada vez que instanciemos un objeto de la clase <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">Book</span> mediante el operador new: <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">Book book = new Book()</span> el atributo <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">pricingStrategy</span> será inyectado con la referencia adecuada.<br /><br />El uso de <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">@Configurable</span>&nbsp;hace uso de la reflectividad por lo que en aquellos objetos que se instancian muy a menudo podríamos incurrir en un serio problema de rendimiento. Adicionalmente, el uso de esta anotación acopla nuestro código a Spring, creando una dependencia hacia el framework.<br /><br />En la siguiente entrada analizaremos el uso de interfaces de dominio y escribiremos nuestros propios aspectos como alternativa a la solución presentada a lo largo de esta entrada.<br /><div><br /></div></div><div style="text-align: justify;"><br /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/35092134-3287935659531502690?l=miguelinlas3.blogspot.com' alt='' /></div>
