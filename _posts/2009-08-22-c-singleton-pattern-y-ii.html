--- 
layout: post
name: c-singleton-pattern-y-ii
title: C++ Singleton Pattern (y II)
time: 2009-08-22 12:14:00 +02:00
---
<span class="Apple-style-span" style="font-family: 'Times New Roman'; "><div style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 3px; padding-right: 3px; padding-bottom: 3px; padding-left: 3px; width: auto; font: normal normal normal 100%/normal Georgia, serif; text-align: left; "><div style="text-align: justify; ">Y ya que estamos, os dejo la segunda parte que también había escrito hace bastante tiempo :)  </div><div style="text-align: justify; "><br /></div><div style="text-align: justify; ">Vamos a continuar con el patrón de diseño Singleton que habíamos comenzado en un post anterior. Intentaremos añadir alguna que otra mejora. Vayamos poquito a poquito:<br /><br />Un primer cambio que podríamos realizar sería el de retornar una referencia en lugar de un puntero en el método getInstance(); de este modo evitaríamos que el usuario que obtiene una referencia del objeto intentase aplicarle el operador delete. El prototipo del nuevo método podría ser algo parecido a lo siguiente:<br /><br /><div style="text-align: center; "><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">static singletonPattern &amp; getInstance();</span><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;"></span><br /></div><br /><br />Ahora podríamos pensar en que ocurre cuando se destruye el singleton.Realmente no se trata un <span style="font-style: italic; ">memory leak</span> tradicional sino un <span style="font-style: italic; ">resource leak</span>. El singleton podría haber adquirido diversos recursos del sistema operativo como un socket,un semáforo,...... Con el objetivo de solucionar este problema, Scott Meyers facilitó una solución sencilla (y muy elegante): en lugar de almacenar un puntero a un objeto de tipo Singleton instancial una variable local estática del siguiente modo:<br /><br /><div style="text-align: center; "><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">singletonPattern &amp; getInstance(){</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">static </span><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">singletonPattern instance;</span><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;"><br />return instance;</span><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;"><br />}<br /></span><div style="text-align: justify; "><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;"></span>El fragmento anterior se conoce como el singleton de Meyers y se basa en, tal y como describe Alexandrecu en su libro <a href="http://www.amazon.com/Modern-Design-Programming-Patterns-Depth/dp/0201704315">Modern C++ Desing:Generic Programming and Patterns Applied</a>, "<i>some compiler magic</i>": un objeto estático de una función es inicializado, en tiempo de ejecución, en el momento de la primera pasada de la definición.<br /><br />Este par de soluciones son, aparentemente sencillas, y pueden ayudarnos a construir un Singleton mucho más robusto.<br /><br />En el libro de Alexandrescu mencionado anteriormente plantea otros problemas tales como las referencias muertas (a las cuales aplica soluciones elegantes e ingeniosas) o los problemas derivados de la interacción de los hilos y los singleton.<br /><br />Desde mi punto de vista el singleton es un patrón de diseño muy sencillo conceptualmente pero que, llegada la hora de implementarlo, no resulta tan evidente como pueda parecer en un principio.</div></div></div></div></span><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/35092134-3434237460394912196?l=miguelinlas3.blogspot.com' alt='' /></div>
