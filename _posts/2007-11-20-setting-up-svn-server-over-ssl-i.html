--- 
layout: post
name: setting-up-svn-server-over-ssl-i
title: Setting up an SVN server (over SSL) (I)
time: 2007-11-20 00:23:00 +01:00
---
<div style="text-align: justify;">Tenía ganas de retomar la parte técnica del blog y aprovechando que estos días he estado instalando Suvbersion y Artifactory (éste aún no lo tengo completamente configurado) he elaborado este mini artículo con los pasos a seguir. En esta primera entrega configuraremos <span style="font-weight: bold;">svnserve</span> (modo standalone) y dejaremos para un segundo artículo la posibilidad de que nuestro sistema controlador de versiones esté disponible a través del protocolo WebDAV (una extensión de http). Manos a la obra:<br /><br />En primer lugar, y tal y como indica el título del post que nos ocupa, estableceremos un servidor SVN a través de una conexión SSL con lo que necesitaremos tener instalados en nuestro sistema dichos componentes. En el caso de mi Ubuntu Feisty podríamos ejecutar el siguiente comando:<br /></div><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>sudo apt-get install subversion openssh-server<br /></code></pre><div style="text-align: justify;">Tras la ejecución del comando anterior tendremos en nuestro equipo todos los elementos necesarios para realizar una configuración totalmente operativa de nuestro sistema de control de versiones.<br /><br /></div>A continuación creamos un nuevo grupo (en mi caso lo he llamado <span style="font-weight: bold;">svnusers</span><span>)</span> para facilitar las labores de administración . Todos  los usuarios que deseen tener acceso deberan ser miembros del grupo anterior (más adelante veremos el porqué). Además crearemos un nuevo usuario perteneciente al grupo anterior con nombre <span style="font-weight: bold;">svnadm</span>. Para llevar a cabo esta tarea ejecutaremos el siguiente conjunto de órdenes:<br /><br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code># creamos el grupo svnusers<br />addgroup svnusers<br /><br /># creamos el usuario "test" perteneciente al grupo svnusers<br />adduser --ingroup svnusers test<br /></code></pre><span style="font-size:78%;">Nota: por motivos de seguridad es una buena práctica que el usuario root no pueda realizar login a través de una conexión de ssh. Asimismo </span><span style="font-weight: bold;font-size:78%;" >ninguno</span><span style="font-size:78%;"> de los usuarios pertenecientes al grupo svnusers debería ser capaz de "</span><span style="font-weight: bold; font-style: italic;font-size:78%;" >hacer su hacia root</span><span style="font-size:78%;">".<br /></span><br />Llegados a este punto necesitamos que los usuarios del grupo svnusers no inhabiliten, en el momento en que establecen una conexión a través del tunel ssh,los permisos establecidos a nivel de grupo; para ello establecemos la máscara al valor 002. Una manera sencilla de hacer ésto es editar el fichero .bashrc de cada uno de los usuarios pertenecientes al grupo svnsusers y añadir la siguiente línea:<br /><br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code># permitimos lectura/escritura al usuario y al grupo pero no al resto<br />umask 002<br /></code></pre>Reptimos los dos últimos pasos descritos anteriormente y creamos el usuario <span style="font-weight: bold;">svnadm</span>.<br /><br />Nos logueamos como usuario root, en caso de que no lo estuviéramos, y creamos una ruta en nuestro sistema de archivos para contener nuestros repositorios. Suponiedo que path_to_repository contiene una ruta válida dentro de nuestro sistema de archivos podríamos ejecutar la siguiente orden:<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>mkdir -p path_to_repository<br /></code></pre>Además restringimos el acceso a los repositorios al root y los usuarios pertenecientes al grupo svnusers<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>chown -R root.svnusers path_to_repository<br />chmod -R u+wxr,+gwxr,o-wxr path_to_repository<br /></code></pre>El paso que a continuación se indica (lo encontré en una mini guía buscando cosas relativas a la seguridad) pretende "esconder" la ruta raíz del servidor donde estamos almacenando todos nuestros repositorios. Para ello sustituiremos nuestro ejecutable svnserve del modo que a continuación se indica:<br /><br />Renombramos el comando svnserve (en mi caso lo tengo disponible en /usr/bin/) con el nombre svnserve.bin<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>mv /usr/bin/svnserve /usr/bin/svnserve.bin<br /></code></pre>Creamos un nuevo fichero /usr/bin/svnserve que contendrá el siguiente código:<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>#!/bin/sh<br /># wrap in order to put root in by default<br /># Script implemented by Adrian Robert &lt;arobert@cogsci.ucsd.edu&gt;<br /><br />exec /usr/bin/svnserve.bin -r /path/to/repository/root "$@"<br /></code></pre>El fichero recién creado podrá ser ejecutado y leído por todo el mundo<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>chmod u+wrx,g+rx-w,o+xr-w /usr/bin/svnserve<br /></code></pre><br /><div>Un vez llegados a este punto estamos en disposición de crear un nuevo proyecto en nuestro repositorio. Nos logueamos como usuario svnadm e introducimos la siguiente orden en una terminal:<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>svnadmin create path_to_repository/nombre_proyecto<br /></code></pre>No permitimos el acceso a ningún usuario no perteneciente al grupo svnusers (a excepción del root claro está)<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code>chmod -R o-rwx path_to_repository/nombre_proyecto<br /></code></pre>Editamos el fichero de configuración del proyecto recientemente creado para no permitir accesos anónimos (sólo aquellos autenticados a través de ssh) y además permitimos la escritura (una vez autenticados). Esto se consigue editando el fichero svnserve.conf de un modo similar al que a continuación se indica:<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code># abrimos el fichero de configuración de nuestro nuevo proyecto<br />vi path_to_repository/nombre_proyecto/conf/svnserve.conf<br /><br /># no se permite el acceso anónimo y si la escritura para usuarios autenticados<br /></code>[general]<br />anon-access = none<br />auth-access = write<br /><br /></pre>Para testear que todo marcha correctamente ejecutamos al siguiente orden:<br /></div><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;">svn list svn+ssh://<usuario>@localhost/nombre_proyecto<br /></usuario></pre> Se nos pedirá un nombre y un password y en caso de que los datos introducidos sean correctos seremos devueltos al prompt donde tecleamos la orden (el proyecto que hemos creado unos pasos más arriba no contiene ningún tipo de información). Con ésto nos aseguramos que el servidor ssh está funcionando correctamente así como el tunel hacia el svnserve.<br /><br />En este mismo instante dispondríamos de un repositorio Subversion totalmente funcional aunque cada vez que realizásemos una operación se nos pediría que introdujésemos nuestro usuario y contraseña correspondientes. Con el objetivo de evitarnos este pequeño incordio generaremos un par de claves públicas/privadas.<br />A continuación, y de manera rápida, se indica el modo en que llevaríamos a cabo esta tarea:<br /><pre style="border: 1px dashed rgb(153, 153, 153); padding: 5px; overflow: auto; font-family: Andale Mono,Lucida Console,Monaco,fixed,monospace; color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); font-size: 12px; line-height: 14px; width: 100%;"><code># generamos nuestro par de claves<br />ssh-keygen -t dsa<br /><br /># copiamos nuestra clave pública a las claves autorizadas<br />cd $HOME/.ssh/<br />cp id_rsa.pub authorized_keys<br /><br /># permisos adecuados<br />chmod 0700 </code><code>$HOME/</code><code>.ssh/<br />chmod 0600 </code><code></code><code>$HOME/</code><code>.ssh/</code><code>authorized_keys<br /></code></pre>Esto ha sido todo. Como veis son un conjunto sencillo de pasos gracias a los cuales establecemos una configuración básica de un repositorio subversion a través de una conexión segura.<br /><br />En el siguiente capítulo haremos que nuestro repositorio se encuentre accesible a través del protocolo WebDAV; (mucho más sencillo que ésto :) )<br /><br />Espero que  os haya gustado y que os sirva de ayuda.<br /><br />Hasta pronto!<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/35092134-153238564228818742?l=miguelinlas3.blogspot.com' alt='' /></div>
