--- 
layout: post
name: groovy-metaprogramming-categories-i
title: "Groovy Metaprogramming: Categories (I)"
time: 2009-12-20 18:24:00 +01:00
---
<div style="text-align: justify;"><i>Groovy</i> nos ofrece un amplio conjunto de técnicas de metaprogramación: <i>Categories, Interceptors, metaclases</i>, etc. A lo largo de una serie de posts analizaremos en detalle algunas de las características anteriores: comencemos por las <i>Categories.</i><br /></div><div style="text-align: justify;"><i><br /></i><br /></div><div style="text-align: justify;">En muchas ocasiones es necesario que alguna clase que no está bajo nuestro control disponga de métodos adicionales. Gracias a las <i>Categories,</i>&nbsp;<i>Groovy</i>&nbsp;introduce esta funcionalidad en el lenguaje (la ha tomado prestada de <a href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_4_section_7.html">Objective-C</a>). El propio lenguaje incorpora alguna <i>Category </i>como <i>DOMCategory o</i>&nbsp;<i>ServletCategory</i>, de la cual vamos a ver algún sencillo ejemplo.<br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">El principal objetivo de&nbsp;<i>ServletCategory</i> persigue que&nbsp;los atributos de objetos que implementan el <i>Servlet API </i>puedan ser<i>&nbsp;</i>tratados como <i>properties&nbsp;</i>dado que no siguen las convenciones establecidas por <i>JavaBeans</i>.<br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">En el ejemplo de <i>GroovyServlet</i> visto en un post anterior (<a href="http://miguelinlas3.blogspot.com/2009/12/groovlets.html">Groovlets</a>), analizamos cómo nuestros scripts <i>Groovy</i>&nbsp;podían actuar como <i>servlets, </i>permitiéndonos realizar accesos mediante<i> properties</i> contra el objeto de la <i>request</i>. Para conseguir ésto, desde el código Java, se invoca a GroovyCategorySupport de un modo similar al siguiente:<br /><br /><span style="color: #222233; font-family: tahoma,verdana,sans-serif; font-size: 13px;"></span><br /><pre class="code-java"><span style="font-family: 'Courier New',Courier,monospace;">Closure closure = </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">new</span></span><span style="font-family: 'Courier New',Courier,monospace;"> Closure(gse) {<br />   </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">public</span></span><span style="font-family: 'Courier New',Courier,monospace;"> </span><span style="background-color: inherit; color: #910091;"><span style="font-family: 'Courier New',Courier,monospace;">Object</span></span><span style="font-family: 'Courier New',Courier,monospace;"> call() {<br />       </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">try</span></span><span style="font-family: 'Courier New',Courier,monospace;"> {<br />           </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">return</span></span><span style="font-family: 'Courier New',Courier,monospace;"> ((GroovyScriptEngine) getDelegate()).run(scriptUri, binding);<br />       } </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">catch</span></span><span style="font-family: 'Courier New',Courier,monospace;"> (ResourceException e) {<br />           </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">throw</span></span><span style="font-family: 'Courier New',Courier,monospace;"> </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">new</span></span><span style="font-family: 'Courier New',Courier,monospace;"> RuntimeException(e);<br />       } </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">catch</span></span><span style="font-family: 'Courier New',Courier,monospace;"> (ScriptException e) {<br />           </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">throw</span></span><span style="font-family: 'Courier New',Courier,monospace;"> </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">new</span></span><span style="font-family: 'Courier New',Courier,monospace;"> RuntimeException(e);<br />       }<br />   }<br />};<br />GroovyCategorySupport.use(ServletCategory.class, closure);</span></pre><br /></div><div><br />Gracias al código anterior podríamos acceder mediante su nombre a diversos componentes como la <i>session</i> o la <i>request:</i><br /><span style="color: #222233; font-family: tahoma,verdana,sans-serif; font-size: 13px;"></span><br /><pre class="code-java"><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">if</span></span><span style="font-family: 'Courier New',Courier,monospace;"> (session.count == </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">null</span></span><span style="font-family: 'Courier New',Courier,monospace;">) session.count = 1;</span></pre>en lugar de acceder a través del API:<br /><span style="color: #222233; font-family: tahoma,verdana,sans-serif; font-size: 13px;"></span><br /><pre class="code-java"><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">if</span></span><span style="font-family: 'Courier New',Courier,monospace;"> (session.getAttribute(</span><span style="background-color: inherit; color: #009100;"><span style="font-family: 'Courier New',Courier,monospace;">"count"</span></span><span style="font-family: 'Courier New',Courier,monospace;">) == </span><span style="background-color: inherit; color: #000091;"><span style="font-family: 'Courier New',Courier,monospace;">null</span></span><span style="font-family: 'Courier New',Courier,monospace;">) then session.setAttribute(</span><span style="background-color: inherit; color: #009100;"><span style="font-family: 'Courier New',Courier,monospace;">"count"</span></span><span style="font-family: 'Courier New',Courier,monospace;">, 1);</span></pre>Con este pequeño ejemplo hemos visto qué son y cómo podemos utilizar las&nbsp;<i>Categories</i> proporcionadas por el lenguaje pero . . . ¿Cuáles son los pasos a seguir si deseamos crear nuestras propias <i>Categories</i>?<br />Asentemos los conocimientos que hemos adquirido en esta entrada para generar nuestras propias construcciones en el siguiente post :).<br /><br />Hasta pronto!<br /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/35092134-2600788280739095861?l=miguelinlas3.blogspot.com' alt='' /></div>
