--- 
layout: post
name: aop-non-kinded-pointcuts
title: "AOP: non kinded pointcuts"
time: 2010-05-03 23:48:00 +02:00
---
<div style="text-align: justify;">En la entrada <a href="http://miguelinlas3.blogspot.com/2010/05/aop-kinded-pointcuts.html">anterior</a>&nbsp;analizábamos aquellos tipos de pointcuts en los que los&nbsp;<i>joint point&nbsp;</i>seleccionados encajaban en una determinada categoría (de ahí su nombre).</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"></div>El mecanismo implementado mediante <b>non-kinded&nbsp;</b><span class="italic"><b>pointcuts</b></span>&nbsp;permite la selección de&nbsp;<span class="italic"><i>joint points</i></span>&nbsp;basados en criterios adicionales a las signaturas vistas anteriormente. Por ejemplo, podremos seleccionar todos los&nbsp;<span class="italic"><i>joint point</i></span>&nbsp;donde el objeto&nbsp;<span class="italic"><i>this</i></span><i>&nbsp;</i>es de un determinado tipo. Dicho&nbsp;<span class="italic"><i>joint point</i></span>&nbsp;incluiría las llamadas a métodos, ejecuciones, manejadores de excepciones, etc.<br /><br />A continuación, a través de ejemplos, veremos los diferentes tipos de&nbsp;<span class="italic"><b>non-kinded pointcuts</b></span>&nbsp;ofrecidos por&nbsp;<span class="italic"><b>AspectJ.</b></span><br /><span class="italic"><b></b></span><br /><b><div class="section" style="font-weight: normal;" title="Modelo de Joint Point"><div class="section" title="Implementación de pointcuts"><div class="section" title="Non-kinded pointcuts"><div class="section" title="Non-kinded pointcuts basados en control de flujo"><div class="titlepage"><div><div><h6 class="title" style="text-align: center;"><span class="Apple-style-span" style="font-size: medium;">Non-kinded pointcuts basados en control de flujo</span></h6></div></div></div><br /><table border="1" frame="void" id="d0e2227"><col width="35%"></col><col width="65%"></col><thead><tr><th>Pointcut</th><th>Descripción</th></tr></thead><tbody><tr><td><span class="italic">cflow( execution(* TransactionManager. commit() ))</span></td><td>Selecciona todos los&nbsp;<span class="italic">joint points</span>&nbsp;en el flujo de la ejecución de cualquier operación&nbsp;<span class="italic">commit</span>&nbsp;de la clase&nbsp;<span class="italic">TransactionManager</span>, incluyendo la ejecución del propio método.</td></tr><tr><td><span class="italic">cflowbellow( execution(* TransactionManager. commit() ))</span></td><td>Selecciona todos los&nbsp;<span class="italic">joint points</span>&nbsp;en el flujo de la ejecución de cualquier operación&nbsp;<span class="italic">commit</span>&nbsp;de la clase&nbsp;<span class="italic">TransactionManager</span>, excluyendo la ejecución del método.</td></tr><tr><td><span class="italic">cflow(execution(@Secured * * (..)))</span></td><td>Todos los&nbsp;<span class="italic">joint points</span>&nbsp;en el flujo de la ejecución de cualquier método anotado con la anotación&nbsp;<span class="italic">Secured</span></td></tr><tr><td><span class="italic">cflow(transacted())</span></td><td>Cualquier joint point en el flujo de ejecución de los&nbsp;<span class="italic">joint points</span>&nbsp;seleccionados por el&nbsp;<span class="italic">pointcut</span>&nbsp;<span class="italic">transacted()</span></td></tr></tbody></table></div><div class="section" title="Non-kinded pointcuts basados en la estructura léxica"><div class="titlepage"><div><div><h6 class="title" style="text-align: center;"><a href="" id="d0e2312" xmlns:saxon="http://icl.com/saxon"></a><span class="Apple-style-span" style="font-size: medium;">Non-kinded&nbsp;</span><span class="italic"><span class="Apple-style-span" style="font-size: medium;">pointcuts</span></span><span class="Apple-style-span" style="font-size: medium;">&nbsp;basados en la estructura léxica</span></h6></div></div></div>Dentro de este tipo de&nbsp;<span class="italic">pointcuts</span>&nbsp;tenemos dos categorías:<br /><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="italic"><i>within(TypeSingnature)</i></span>: selecciona cualquier&nbsp;<span class="italic">joint point</span>&nbsp;que aparece en el cuerpo de las clases y aspectos que concuerden con el tipo especificado.</li><li class="listitem"><span class="italic"><i>withincode(ConstructorSignature)</i></span><i>,</i><span class="italic"><i>withincode(MethodSignature)</i></span>: selecciona cualquier&nbsp;<span class="italic">joint point</span>&nbsp;que aparezca dentro de un método o un constructor, incluyendo la definición de cualquier clase local que pudiera aparecer en los mismos.</li></ul></div><br /><table border="1" frame="void" id="d0e2345"><col width="35%"></col><col width="65%"></col><thead><tr><th>Pointcut</th><th>Descripción</th></tr></thead><tbody><tr><td><span class="italic">within(User)</span></td><td>Selecciona todos los&nbsp;<span class="italic">joint points</span>&nbsp;que aparecen dentro de la clase&nbsp;<span class="italic">User</span></td></tr><tr><td><span class="italic">within(User+)</span></td><td>Selecciona todos los&nbsp;<span class="italic">joint points</span>&nbsp;que aparecen dentro de la clase user y cualquiera de sus clases derivadas</td></tr><tr><td><span class="italic">within(@Transactional *)</span></td><td>Selecciona todos los&nbsp;<span class="italic">joint points</span>&nbsp;que aparecen dentro de cualquier clase que se encuentre marcada con la notación&nbsp;<span class="italic">Transactional</span></td></tr><tr><td><span class="italic">withincode(* TransactionManager. retrieve*(..))</span></td><td>Selecciona todos los&nbsp;<span class="italic">joint points</span>&nbsp;que parecen dentro de cualquier método de la clase&nbsp;<span class="italic">TransactionManager</span>&nbsp;cuyo nombre comience por&nbsp;<span class="italic">retrieve</span></td></tr></tbody></table></div><div class="section" title="Non-kinded pointcuts de ejecución"><div class="titlepage"><div><div><h6 class="title" style="text-align: center;"><a href="" id="d0e2420" xmlns:saxon="http://icl.com/saxon"></a><span class="Apple-style-span" style="font-size: medium;">Non-kinded&nbsp;</span><span class="italic"><span class="Apple-style-span" style="font-size: medium;">pointcuts</span></span><span class="Apple-style-span" style="font-size: medium;">&nbsp;de ejecución</span></h6></div></div></div>Este tipo de&nbsp;<span class="italic">pointcuts</span>&nbsp;permite seleccionar&nbsp;<span class="italic">joint points</span>&nbsp;en base al tipo de los objetos en tiempo de ejecución. De este modo se dispone de:<br /><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="italic">this()</span>. Acepta dos formas diferentes:&nbsp;<span class="italic">this(ObjectIdentifier)</span>&nbsp;o&nbsp;<span class="italic">this(Type)</span>. Seleccionará aquellos&nbsp;<span class="italic">joint points</span>&nbsp;cuyo objeto this sea del tipo (o el objeto) indicado.</li><li class="listitem"><span class="italic">target()</span>. Similar al concepto anterior, aunque en este caso, se utilizar el&nbsp;<span class="italic">target</span>&nbsp;del&nbsp;<span class="italic">joint point</span>&nbsp;en lugar del&nbsp;<span class="italic">this</span>.</li></ul></div><br /><table border="1" frame="void" id="d0e2465"><col width="20%"></col><col width="80%"></col><thead><tr><th>Pointcut</th><th>Descripción</th></tr></thead><tbody><tr><td><span class="italic">this(User)</span></td><td>Selecciona cualquier&nbsp;<span class="italic">joint point</span>&nbsp;en que la expresión&nbsp;<span class="italic">this instanceof User</span>&nbsp;sea cierta. Así por ejemplo, seleccionará las llamadas a métodos o accesos a campos donde el objeto actual sea de tipo&nbsp;<span class="italic">User</span>&nbsp;o cualquier de sus subclases.</td></tr><tr><td><span class="italic">target(User)</span></td><td>Selecciona cualquier&nbsp;<span class="italic">joint point</span>&nbsp;en el que el objeto sobre el que se realiza la llamada al método es&nbsp;<span class="italic">instanceof User</span></td></tr></tbody></table></div><div class="section" title="Non-kinded pointcuts sobre argumentos"><div class="titlepage"><div><div><h6 class="title" style="text-align: center;"><a href="" id="d0e2515" xmlns:saxon="http://icl.com/saxon"></a><span class="Apple-style-span" style="font-size: medium;">Non-kinded&nbsp;</span><span class="italic"><span class="Apple-style-span" style="font-size: medium;">pointcuts</span></span><span class="Apple-style-span" style="font-size: medium;">&nbsp;sobre argumentos</span></h6></div></div></div>Este tipo de&nbsp;<span class="italic">pointcuts</span>&nbsp;permite seleccionar&nbsp;<span class="italic">joint points</span>&nbsp;en base al tipo de los argumentos en tiempo de ejecución. Veamos los distintos tipos de argumentos, en función del tipo del&nbsp;<span class="italic">joint point</span>&nbsp;:<br /><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">En el caso de los&nbsp;<span class="italic">joint points</span>&nbsp;manejadores de excepciones el argumento será la excepción manejada.</li><li class="listitem">En los métodos y constructores, los argumentos serán los argumentos del método y constructor.</li><li class="listitem">En los accesos de modificación de un campo, el argumento será el nuevo valor que va a tomar dicho campo.</li></ul></div><br /><table border="1" frame="void" id="d0e2547"><col width="20%"></col><col width="80%"></col><thead><tr><th>Pointcut</th><th>Descripción</th></tr></thead><tbody><tr><td><span class="italic">args(User, . . , String)</span></td><td>Selecciona cualquier&nbsp;<span class="italic">joint point</span>&nbsp;de tipo método o constructor en el que el primer argumento es de tipo&nbsp;<span class="italic">User</span>&nbsp;(o cualquiera de sus subclases), y el último argumento es de tipo&nbsp;<span class="italic">String</span>.</td></tr><tr><td><span class="italic">args (SqlException)</span></td><td>Selecciona cualquier&nbsp;<span class="italic">joint point</span>&nbsp;con un único argumento de tipo&nbsp;<span class="italic">SqlException</span>. Seleccionaría cualquier método o constructor que esperase un único argumento de tipo&nbsp;<span class="italic">SqlException</span>, un acceso de escritura a un campo estableciendo un nuevo valor de tipo&nbsp;<span class="italic">SqlException</span>, y también seleccionaría un manejador de excepciones de tipo&nbsp;<span class="italic">SqlException</span></td></tr></tbody></table></div><div class="section" title="Non-kinded pointcuts condicionales"><div class="titlepage"><div><div><h6 class="title" style="text-align: center;"><a href="" id="d0e2607" xmlns:saxon="http://icl.com/saxon"></a><span class="Apple-style-span" style="font-size: medium;">Non-kinded pointcuts condicionales</span></h6></div></div></div>Este tipo de&nbsp;<span class="italic">pointcuts</span>&nbsp;permiten seleccionar&nbsp;<span class="italic">joint points</span>&nbsp;basados en una expresión condicional.<br /><br /><table border="1" frame="void" id="d0e2620"><caption></caption><col width="20%"></col><col width="80%"></col><thead><tr><th>Pointcut</th><th>Descripción</th></tr></thead><tbody><tr><td><span class="italic">if(debug)</span></td><td>Selecciona cualquier&nbsp;<span class="italic">joint point</span>&nbsp;donde el campo estático&nbsp;<span class="italic">debug</span>&nbsp;(en la definición del aspecto) toma el valor cierto</td></tr></tbody></table><br /></div><div class="section" style="text-align: justify;" title="Non-kinded pointcuts condicionales">Poco a poco vamos completando, de manera sencilla, una idea general de los mecanismos que nos ofrece la orientación a aspectos en general, y <b>AspectJ</b> en particular. En la siguiente entrada analizaremos los conceptos de crosscutting dinámico y los mecanismos disponibles para la modificación del comportamiento de un programa en un determinado <i>joint point</i>.</div></div></div></div><div class="section" style="font-weight: normal;" title="Crosscutting dinámico"><div class="titlepage"><div><div></div></div></div></div></b><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/35092134-3737327033102555850?l=miguelinlas3.blogspot.com' alt='' /></div>
