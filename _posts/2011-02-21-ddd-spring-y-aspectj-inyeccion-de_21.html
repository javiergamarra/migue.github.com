--- 
layout: post
name: ddd-spring-y-aspectj-inyeccion-de_21
title: "DDD, Spring y AspectJ: inyecci\xC3\xB3n de depencias (II)"
time: 2011-02-21 22:44:00 +01:00
---
<div style="text-align: justify;">En la <a href="http://miguelinlas3.blogspot.com/2011/02/ddd-spring-y-aspectj-inyeccion-de.html">entrada anterior</a> analizabamos el uso de la anotación <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">Configurable</span> y cómo esta nos ayudaba a realizar la inyección de dependencias en nuestro objetos de dominio, ayudándonos de esta manera a realizar nuestro diseño siguiendo una filosofía orientada al dominio (podréis encontrar mucha información, artículos, referencias, ponencias, . . ., relativas a este tema en&nbsp;<a href="http://domaindrivendesign.org/">http://domaindrivendesign.org/</a>).</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Como ya comentamos anteriormente el uso de la anotación <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">Configurable</span>&nbsp;era beneficioso aunque si la clase anotada se instancia un gran número de veces podríamos incurrir en una notable pérdida de rendimiento puesto que la anotación anterior hace uso de la reflectividad. Adicionalmente, indicábamos que &nbsp;otro de los "problemas" era que nuestro código estaba acoplado a la plataforma, en este caso, Spring. Durante esta entrada plantearemos otro mecanismo de inyección de dependencias en nuestros objetos de dominio: <b>inyección basada en interfaces de dominio</b>.<br /><br />Partiendo del ejemplo analizado en el ejemplo anterior, definiremos un nuevo interface <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">PricingStrategyClient</span> que presentará el método <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">setPricingStrategy(PricingyStrategy pricingStrategy)</span> . Todas aquellas entidades de nuestro dominio que necesiten esta funcionalidad deberán implementar el interfaz anterior.<br /><br />Hasta el momento no hemos anotado nuestra clase con ningún artefacto adicional (@Configurable) por lo que ahora tendremos que escribir nuestro propio aspecto para inyectar las dependencias en nuestra clase de dominio. Para llevar a cabo este trabajo extenderemos&nbsp;un aspecto abstracto disponible en <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">spring-aspects-3.0.5.jar</span> (los ejemplos de estas entradas están desarrollados con la versión 3.0.5 de Spring) de tipo <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">GenericInterfaceDrivenDependencyInjectionAspect</span>. De manera resumida, este aspecto base determina cuando se crea una nueva instancia (o serializa) de nuestra clase e invoca al método <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">configureBean</span>. Nosotros únicamente deberemos implementar el método <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">configure</span> tal y como se muestra en el siguiente fragmento de código:<br /><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">public aspect PricingStrategyDIAspect extends</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp;&nbsp;GenericInterfaceDrivenDependencyInjectionAspect<pricingstrategyclient> {</pricingstrategyclient></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>protected PricingStrategy pricingStrategy;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>public PricingStrategy getPricingStrategy() {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>return pricingStrategy;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>public void setPricingStrategy(PricingStrategy pricingStrategy) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>this.pricingStrategy = pricingStrategy;</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>@Override</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>protected void configure(PricingStrategyClient bean) {</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>bean.setPricingStrategyClient(pricingStrategy);</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>}</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">}</span><br /><br />Como último paso de nuestra nueva solución sólo tendremos que definir nuestro nuevo aspecto en el contexto de aplicación:<br /><div style="text-align: left;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&lt;bean id="pricingStrategy" class="com.blogspot.miguelinlas3.springexamples.ddd.domain.strategy.SimplePricingStrategy"/&gt;</span></div><br /><div style="text-align: left;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&lt;bean class="com.blogspot.miguelinlas3.springexamples.ddd.domain.interfacedibased.PricingStrategyDIAspect"</span></div><div style="text-align: left;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">factory-method="aspectOf"&gt;</span></div><div style="text-align: left;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&lt;property name="pricingStrategy" ref="pricingStrategy"/&gt;</span></div><div style="text-align: left;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&lt;/bean&gt;</span></div><div>Una posible mejora sería incluir el aspecto anterior como un aspecto estático dentro del interfaz <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">PricingStrategyClient</span> de modo que estaríamos enfatizando la relación entre ambos aunque esto os lo dejo como ejercicio ;)</div></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/35092134-7552811920471676790?l=miguelinlas3.blogspot.com' alt='' /></div>
