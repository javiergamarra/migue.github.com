--- 
layout: post
name: c-singleton-pattern-i
title: C++ Singleton Pattern (I)
time: 2009-08-22 12:03:00 +02:00
---
<span class="Apple-style-span" style="font-family: 'Times New Roman'; "><div style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 3px; padding-right: 3px; padding-bottom: 3px; padding-left: 3px; width: auto; font: normal normal normal 100%/normal Georgia, serif; text-align: left; "><div style="text-align: justify; ">Os dejo un post que había escrito hace mucho tiempo en otro blog; está dedicado a C++ y a los patrones de diseño.</div><div style="text-align: justify; "><br /></div><div style="text-align: justify; ">Os propongo una implementación del patrón de diseño Singleton (uno de los patrones de diseño más simples aunque creo que muchas veces lo utilizamos de forma no demasiado apropiada).<br /><br />El patrón anterior nos garantiza que, desde el momento en que instanciamos un objeto de dicha clase, será esa la única instancia que exista de dicho objeto. Existen multitud de libros acerca de patrones de diseño y con multitud de aplicaciones de los mismos. Yo desde aquí nada más pretendo dejaros mi experiencia y el uso que yo le he dado en mis aplicaciones. Por ejemplo, este patrón lo he utilizado en el desarrollo de un compilador para representar los <span style="font-style: italic; ">builtin type</span>. Vamos allá:<br /><br />En primer lugar definimos la clase singletonPattern y el método que nos permitira obtener una referencia al mismo (hacemos que el constructor sea privado para que no se puedan crear objetos de ese tipo):<br /><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">class singletonPattern{</span><br /><span style="font-weight: bold; color: rgb(255, 0, 0); font-family:courier new;">private:</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;"><span style="color: rgb(51, 204, 0); ">/// unique instance of the object</span></span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">static singletonPattern * instance;</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;"><span style="color: rgb(51, 204, 0); ">/// Default Constructor</span></span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">singletonPattern(){}</span><br /><br /><span style="font-weight: bold; color: rgb(255, 0, 0); font-family:courier new;">public:</span><br /><span style="font-weight: bold; color: rgb(51, 204, 0); font-family:courier new;">/*!</span><br /><span style="font-weight: bold; color: rgb(51, 204, 0); font-family:courier new;">Returns the reference<br />to the unique instance of the object</span><br /><span style="font-weight: bold; color: rgb(51, 204, 0); font-family:courier new;">(if it's the first time create de reference)</span><br /><span style="font-weight: bold; color: rgb(51, 204, 0); font-family:courier new;">*/</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">static singletonPattern * getInstance(){</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">if(instance == NULL)</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">instance = new singletonPattern();</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">return instance;</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">}</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">};</span><br /><br /><span style="font-weight: bold; color: rgb(255, 0, 0); font-family:courier new;">// init the static member</span><br /><span style="font-weight: bold; color: rgb(51, 102, 255); font-family:courier new;">singletonPattern * singletonPattern :: instance = NULL;</span><br /><br />El código anterior no estaría completo dado que nos queremos asegurar de que nuestra instancia sea única por lo que tendremos que implementar el constructor de copia y el operador de asignación (no tiene sentido el operador de asignación en el singleton) como privados dentro de nuestra clase singletonPattern. Algo como lo que sigue:<br /><br /><span style="font-weight: bold; color: rgb(51, 204, 0); ">/// Copy Constructor</span><br /><span style="color: rgb(51, 102, 255); font-weight: bold; font-family:courier new;">singletonPattern(const singletonPattern &amp; sp){}</span><br /><br /><span style="color: rgb(51, 204, 0); font-weight: bold; ">/// Assignement Operator</span><br /><span style="color: rgb(51, 102, 255); font-weight: bold; font-family:courier new;">singletonPattern &amp; operator=(singletonPattern &amp; sp){</span><br /><span style="color: rgb(51, 102, 255); font-weight: bold; font-family:courier new;">return *this;</span><br /><span style="color: rgb(51, 102, 255); font-weight: bold; font-family:courier new;">}</span><br /><br />Si quisieramos utilizar esta clase en uno de nuestros programas no tendríamos más que declarar un objeto tal y como a continuación se muestra:<br /><span style="color: rgb(51, 102, 255); font-weight: bold; "></span><span style="color: rgb(51, 102, 255); font-weight: bold; font-family:courier new;">singletonPattern * singleton = singletonPattern::getInstance();</span><br /><br />Y listo. Con esto tendremos nuestro patrón de diseño Singleton listo para disponer de el cuando deseemos.<br /><br />Desde el siguiente enlace podeis descargaros el código fuente completo junto con un makefile:<a href="http://www.box.net/public/z0u1c2c0ao">singletonPatterC++</a>.<br /><br />Hasta pronto!</div></div></span><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/35092134-5210618775105981155?l=miguelinlas3.blogspot.com' alt='' /></div>
